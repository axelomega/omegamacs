name: Spell Check

on:
  push:
    paths:
      - "**.el"
      - ".github/workflows/spellcheck.yml"
  pull_request:
    paths:
      - "**.el"
      - ".github/workflows/spellcheck.yml"

jobs:
  spellcheck:
    runs-on: ubuntu-latest
    steps:
      - name: Checkout
        uses: actions/checkout@v4

      - name: Install aspell
        run: sudo apt-get update && sudo apt-get install -y aspell aspell-en

      - name: Spell check Emacs Lisp comments
        run: |
          # Spell check .el files using aspell with context filters
          find . -name "*.el" -exec cat {} + | \
            aspell list \
              --ignore-case \
              --add-filter=context \
              --add-context-delimiters='; \0' \
              --rem-context-delimiters='" "' \
              --personal=./.github/aspell-dict | \
            sort -u > misspelled_words.el.txt

          if [ -s misspelled_words.txt ]; then
            echo "::error::Misspelled words found:"
            cat misspelled_words.el.txt
            exit 1
          else
            echo "No misspelled words found"
          fi

      - name: Spell check MD files
        run: |
          # Spell check .md files using aspell with context filters
          find . -name "*.md" -exec cat {} + | \
            aspell list \
              --ignore-case \
              --mode=markdown \
              --personal=./.github/aspell-dict | \
            sort -u > misspelled_words.md.txt

          if [ -s misspelled_words.txt ]; then
            echo "::error::Misspelled words found:"
            cat misspelled_words.md.txt
            exit 1
          else
            echo "No misspelled words found"
          fi
